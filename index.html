<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Jurassic Spell Run ‚Ä¢ Professor Peter's Lab</title>
  <style>
    :root{
      --bg:#0c1222;
      --panel:#1b2236;
      --accent:#ffd460;
      --accent2:#58e28a;
      --danger:#ff6b6b;
      --text:#e9eef6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(100% 140% at 50% -10%, #173057 0%, var(--bg) 60%);
      color:var(--text);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:16px;
    }
    .app{
      width:100%;
      max-width:980px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    h1{
      font-size: clamp(20px, 3.2vw, 34px);
      letter-spacing:1px;
      margin:0;
      text-shadow: 0 2px 0 #0008;
    }
    .subtitle{opacity:.85; font-size:14px; margin-top:2px}
    .card{
      background: linear-gradient(#232b43,#161d31);
      border:2px solid #2d3760;
      border-radius:16px;
      box-shadow: 0 12px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
      overflow:hidden;
    }
    .card .inner{ padding:14px }
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    @media (min-width:900px){
      .grid{ grid-template-columns: 1.1fr .9fr; }
    }
    /* Game canvas with crunchy pixels */
    #gameWrap{ padding:10px; }
    #gameCanvas{
      width:100%;
      aspect-ratio: 16 / 9;
      background:#5eb9ff;
      border-radius:12px;
      border:3px solid #0d1b2a;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      box-shadow: inset 0 0 0 3px #263b54, 0 10px 24px rgba(0,0,0,.35);
      display:block;
    }
    .hud{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-top:10px;
    }
    .lives{font-size:22px; letter-spacing:2px}
    .pill{
      background:#0e1627; border:1px solid #22325a; border-radius:999px; padding:8px 12px; font-weight:600;
    }
    .controls{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    input[type="text"], textarea{
      width:100%;
      background:#0e1627;
      border:2px solid #22325a;
      color:var(--text);
      border-radius:12px;
      padding:12px 12px;
      font-size:18px; /* avoid iOS zoom */
      outline:none;
    }
    textarea{ min-height:120px; resize:vertical }
    button{
      appearance:none; border:none;
      background:linear-gradient(#ffe08a,#ffc34d);
      color:#2a1b00; font-weight:800;
      padding:10px 14px; border-radius:12px;
      border:2px solid #9b6c18; box-shadow: 0 4px 0 #7a540f, 0 8px 18px rgba(0,0,0,.35);
      cursor:pointer; font-size:16px;
    }
    button:active{ transform: translateY(1px); box-shadow: 0 3px 0 #7a540f, 0 4px 10px rgba(0,0,0,.35); }
    .btn-secondary{
      background:linear-gradient(#8fe6b1,#5bd989);
      border-color:#2f7b52; box-shadow: 0 4px 0 #2b6d49, 0 8px 18px rgba(0,0,0,.35);
      color:#062611;
    }
    .btn-ghost{
      background:#0e1627; color:#cde8f8; border-color:#24345a;
    }
    .row{ display:flex; gap:8px; flex-wrap:wrap }
    .hide{ display:none !important }
    .mono{ font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas, "Liberation Mono","Courier New", monospace }
    /* Sketch pad */
    #sketchPad{
      width:100%; aspect-ratio: 4/3; background:#0b1222; border:3px solid #24345a; border-radius:12px;
      image-rendering: pixelated; touch-action: none; display:block;
      box-shadow: inset 0 0 0 3px #1c2743, 0 6px 16px rgba(0,0,0,.35);
    }
    .sketchBar{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-top:8px;
    }
    .legend{opacity:.85; font-size:13px}
    .badge{
      display:inline-block; padding:4px 8px; border-radius:999px; background:#152038; border:1px solid #273b64; font-size:12px; opacity:.85;
    }
    .tiny{ font-size:12px; opacity:.75 }
    .footerNote{ font-size:12px; opacity:.75; text-align:center; margin-top:8px }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>ü¶ñ Jurassic Spell Run <span class="tiny mono">v1.0</span></h1>
      <div class="subtitle">An 8‚Äëbit style spelling chase. A T‚ÄëRex is after your Jeep‚Äîspell fast to escape!</div>
    </header>

    <!-- Setup card -->
    <section class="card" id="setupCard">
      <div class="inner">
        <div class="row" style="align-items:flex-end; justify-content:space-between">
          <div style="flex:1; min-width:240px;">
            <label for="wordList" class="legend">Paste your spelling words (comma or new line):</label>
            <textarea id="wordList" class="mono" placeholder="dinosaur
fossil
jeep
jungle
escape
tunnel
volcano"></textarea>
          </div>
          <div style="display:flex; flex-direction:column; gap:8px; min-width:220px;">
            <button id="startBtn">Start Game</button>
            <button id="sampleBtn" class="btn-secondary">Load Sample List</button>
            <div class="tiny" style="opacity:.8">Tip: On iPhone/iPad, make sure your device is not muted to hear the word.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Game card -->
    <section class="card hide" id="gameCard">
      <div class="inner" id="gameWrap">
        <canvas id="gameCanvas" width="320" height="180"></canvas>

        <div class="hud">
          <div class="pill"><span id="progress">Word 1/1</span></div>
          <div class="lives" id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        </div>

        <div class="grid" style="margin-top:8px">
          <div>
            <div class="legend" id="prompt">Listen for the word, then type it below.</div>
            <div class="row controls" style="margin-top:6px">
              <input type="text" id="answer" placeholder="Type the word‚Ä¶" autocomplete="off" autocapitalize="none" spellcheck="false" />
              <button id="goBtn">Go</button>
              <button id="replayBtn" class="btn-ghost" title="Hear the word again">üîä</button>
              <button id="resetBtn" class="btn-ghost">Reset</button>
            </div>
          </div>

          <div>
            <div class="legend">Practice the word by drawing it here:</div>
            <canvas id="sketchPad" width="400" height="300"></canvas>
            <div class="sketchBar">
              <button id="clearSketch" class="btn-ghost">Clear</button>
              <button class="btn-ghost" id="thinPen">Thin</button>
              <button class="btn-ghost" id="thickPen">Thick</button>
              <span class="badge">Sketch pad shows by default</span>
            </div>
          </div>
        </div>
        <div class="footerNote">Made for ProfessorPetersLab.com ‚Ä¢ Works on desktop, iPad, and iPhone.</div>
      </div>
    </section>
  </div>

  <script>
  // --- Simple 8-bit runner with T-Rex & Jeep (all inline, no assets) ---
  (()=>{
    // DOM
    const setupCard = document.getElementById('setupCard');
    const gameCard  = document.getElementById('gameCard');
    const startBtn  = document.getElementById('startBtn');
    const sampleBtn = document.getElementById('sampleBtn');
    const goBtn     = document.getElementById('goBtn');
    const replayBtn = document.getElementById('replayBtn');
    const resetBtn  = document.getElementById('resetBtn');
    const answer    = document.getElementById('answer');
    const wordList  = document.getElementById('wordList');
    const livesEl   = document.getElementById('lives');
    const progressEl= document.getElementById('progress');
    const promptEl  = document.getElementById('prompt');

    const gameCanvas= document.getElementById('gameCanvas');
    const g = gameCanvas.getContext('2d');
    const W = gameCanvas.width;
    const H = gameCanvas.height;

    // Sketch pad
    const sketch = document.getElementById('sketchPad');
    const sg = sketch.getContext('2d');
    const clearSketch = document.getElementById('clearSketch');
    const thinPen = document.getElementById('thinPen');
    const thickPen = document.getElementById('thickPen');

    // State
    let words = [];
    let idx = 0;
    let lives = 3;
    let playing = false;
    let ended = false;
    let currentWord = '';
    let gap = 44; // distance between jeep and rex in pixels
    let bgScroll = 0;
    let t = 0;
    let audioCtx = null;

    // Entities (position centered-ish by gap)
    const jeep = { x: 170 + gap/2, y: 120 };
    const rex  = { x: 150 - gap/2, y: 110, frame: 0 };

    // Handle device pixel ratio for sketch pad crispness
    function resizeSketch(){
      const dpr = window.devicePixelRatio || 1;
      const cssW = sketch.clientWidth;
      const cssH = sketch.clientHeight;
      sketch.width  = Math.round(cssW * dpr);
      sketch.height = Math.round(cssH * dpr);
      sg.setTransform(dpr,0,0,dpr,0,0);
      sg.lineCap = 'round';
      sg.lineJoin = 'round';
      sg.lineWidth = penWidth;
      sg.strokeStyle = '#e9eef6';
      sg.fillStyle = '#0b1222';
      sg.fillRect(0,0,sketch.width,sketch.height);
    }
    let penWidth = 4;

    // --- Audio helpers (WebAudio beeps, no external files) ---
    function ensureAudio(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') audioCtx.resume();
    }
    function toneSequence(steps){
      ensureAudio();
      const now = audioCtx.currentTime;
      let t = now;
      steps.forEach(s=>{
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = s.type || 'square';
        o.frequency.value = s.f;
        g.gain.value = 0.0001;
        o.connect(g).connect(audioCtx.destination);
        o.start(t);
        g.gain.setValueAtTime(0.001, t);
        g.gain.exponentialRampToValueAtTime(s.v || 0.3, t + (s.len||0.12)*0.2);
        g.gain.exponentialRampToValueAtTime(0.0001, t + (s.len||0.12));
        o.stop(t + (s.len||0.12));
        t += s.wait || (s.len||0.12)*0.9;
      });
    }
    function sfxCorrect(){
      toneSequence([
        {f: 660, len: .08, type:'square'},
        {f: 990, len: .08, type:'square'},
        {f:1320, len: .10, type:'square'}
      ]);
    }
    function sfxWrong(){
      toneSequence([
        {f:220, len:.16, type:'sawtooth', v:.25},
        {f:160, len:.18, type:'sawtooth', v:.22}
      ]);
    }
    function sfxRoar(){
      // Low descending growl-ish
      toneSequence([
        {f: 220, len:.20, type:'triangle', v:.35},
        {f: 150, len:.25, type:'triangle', v:.32},
        {f: 110, len:.30, type:'triangle', v:.28}
      ]);
    }
    function sfxEscape(){
      toneSequence([
        {f:523, len:.12},{f:659, len:.12},{f:784, len:.24},
        {f:1046, len:.2, wait:.12}
      ]);
    }

    // --- Speech (Web Speech API) ---
    function speak(text){
      try{
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'en-US';
        u.rate = 0.95;
        // prefer a clear voice if present
        const voices = window.speechSynthesis.getVoices();
        const v = voices.find(v=>/Samantha|Moira|Karen|Daniel|Victoria|Allison|Ava|Alyss/i.test(v.name));
        if(v) u.voice = v;
        window.speechSynthesis.speak(u);
      }catch(e){ /* ignore */ }
    }

    // --- Game flow ---
    function setLives(n){
      lives = Math.max(0, Math.min(3, n));
      livesEl.textContent = '‚ù§Ô∏è'.repeat(lives) + 'ü¶ñ'.repeat(3-lives);
    }
    function setProgress(i,total){
      progressEl.textContent = `Word ${Math.min(i+1,total)}/${total}`;
    }
    function parseWords(text){
      return text.split(/[\n,]+/).map(w=>w.trim()).filter(Boolean);
    }
    function startGame(){
      words = parseWords(wordList.value);
      if(words.length===0){
        // load a default set if none
        words = ['dinosaur','fossil','jeep','jungle','escape','tunnel','volcano'];
      }
      idx = 0; gap = 44; setLives(3); playing = true; ended=false;
      setupCard.classList.add('hide');
      gameCard.classList.remove('hide');
      ensureAudio();
      nextWord(true);
      answer.focus();
    }
    function resetGame(){
      playing=false; ended=false;
      setupCard.classList.remove('hide');
      gameCard.classList.add('hide');
      answer.value='';
      // Clear sketch
      resizeSketch();
    }

    function normalize(s){ return (s||'').trim().toLowerCase(); }

    function nextWord(first=false){
      if(idx >= words.length){ win(); return; }
      currentWord = words[idx];
      setProgress(idx, words.length);
      promptEl.textContent = `Listen and type the word ${idx+1} of ${words.length}.`;
      if(!first){
        // small delay before speaking next word
        setTimeout(()=>speak(currentWord), 350);
      }else{
        speak(currentWord);
      }
    }

    function submitAnswer(){
      if(!playing || ended) return;
      const a = normalize(answer.value);
      const w = normalize(currentWord);
      // one try per word
      if(a === w){
        sfxCorrect();
        gap += 20; // jeep further away
      }else{
        sfxWrong();
        setLives(lives-1);
        gap -= 16; // T-Rex closer
        if(lives<=0){
          // trigger catch
          lose();
          return;
        }
      }
      idx++;
      answer.value='';
      nextWord();
    }

    function lose(){
      ended=true; playing=false;
      sfxRoar();
      // dramatic catch animation: close the gap quickly
      const int = setInterval(()=>{
        gap -= 6;
        if(gap <= 6){
          clearInterval(int);
          gap = 0;
          overlay('ü¶ñ GAME OVER', 'The T‚ÄëRex caught your Jeep!');
        }
      }, 50);
    }

    function win(){
      ended=true; playing=false;
      sfxEscape();
      overlay('üèÅ YOU ESCAPED!', 'You spelled all the words. Through the tunnel you go!');
      // animate jeep driving into a tunnel on right
      let steps = 0;
      const int = setInterval(()=>{
        steps++;
        gap += 2;           // rex falls behind
        bgScroll += 2.2;    // speed up background
        if(steps>120){ clearInterval(int); }
      }, 20);
    }

    // Simple overlay message
    let overlayDiv = null;
    function overlay(title, sub){
      if(overlayDiv){ overlayDiv.remove(); }
      overlayDiv = document.createElement('div');
      overlayDiv.style.position='absolute';
      overlayDiv.style.left='0'; overlayDiv.style.top='0';
      overlayDiv.style.right='0'; overlayDiv.style.bottom='0';
      overlayDiv.style.display='flex'; overlayDiv.style.alignItems='center';
      overlayDiv.style.justifyContent='center';
      overlayDiv.style.pointerEvents='none';
      overlayDiv.innerHTML = `
        <div style="text-align:center; padding:16px 22px; background:rgba(0,0,0,.55); border:2px solid #26466f; border-radius:16px; pointer-events:auto">
          <div style="font-size:28px; font-weight:900; letter-spacing:1px">${title}</div>
          <div style="opacity:.9; margin-top:6px">${sub}</div>
          <div style="margin-top:10px">
            <button id="playAgain" class="btn-secondary">Play Again</button>
          </div>
        </div>`;
      document.getElementById('gameWrap').appendChild(overlayDiv);
      overlayDiv.querySelector('#playAgain').addEventListener('click', ()=>{
        overlayDiv.remove(); overlayDiv=null; resetGame();
      });
    }

    // --- Drawing helpers for crunchy 8-bit look ---
    function drawSky(){
      // gradient sky
      const sky = g.createLinearGradient(0,0,0,H);
      sky.addColorStop(0,'#5eb9ff');
      sky.addColorStop(1,'#9fe4ff');
      g.fillStyle = sky;
      g.fillRect(0,0,W,H);
      // distant mountains
      g.fillStyle = '#6bb769';
      drawHill(0,120, 80, 30);
      drawHill(90,125, 70, 28);
      drawHill(180,118, 90, 34);
      drawHill(260,130, 60, 24);
    }
    function drawHill(x, y, w, h){
      g.fillRect(x,y,w,h);
      g.fillRect(x+Math.floor(w*0.4), y-8, Math.floor(w*0.6), h+8);
    }
    function drawGround(scroll){
      const groundY = 145;
      // grass
      g.fillStyle = '#3ea950';
      g.fillRect(0,groundY,W, H-groundY);
      // dirt stripes (parallax)
      g.fillStyle = '#2b7a3a';
      const stripeH = 6;
      for(let i=0;i<5;i++){
        const y = groundY + 2 + i*stripeH;
        g.fillRect( - (scroll%16), y, W + 16, 2);
      }
      // bushes
      g.fillStyle = '#2e7d32';
      for(let x=-(scroll%40); x<W; x+=40){
        g.fillRect(x, groundY-6, 10, 6);
        g.fillRect(x+6, groundY-10, 8, 10);
      }
    }

    // Pixel-ish Jeep
    function drawJeep(x,y){
      // wheels
      g.fillStyle='#111'; g.fillRect(x-20,y+16, 10,10); g.fillRect(x+16,y+16,10,10);
      // body
      g.fillStyle='#f2d16a'; g.fillRect(x-24,y, 56,16);
      // roll bars
      g.fillStyle='#2b2b2b'; g.fillRect(x-18,y-10, 4,10); g.fillRect(x+10,y-10, 4,10);
      g.fillRect(x-18,y-12, 32,3);
      // cabin
      g.fillStyle='#a9cee8'; g.fillRect(x-10,y-8, 22,8);
      // stripe
      g.fillStyle='#cc2c2c'; g.fillRect(x-24,y+8, 56,3);
      // headlight
      g.fillStyle='#fff59d'; g.fillRect(x+30,y+6, 4,4);
    }

    // Pixel-ish T-Rex
    function drawRex(x,y,frame){
      // tail
      g.fillStyle='#3a6736'; g.fillRect(x-34,y+6, 14,6); g.fillRect(x-22,y+4, 8,8);
      // body
      g.fillRect(x-16,y, 26,18);
      // leg animation
      const off = (frame%20<10)? 0 : 3;
      g.fillRect(x-8,y+18, 8,8);           // left thigh
      g.fillRect(x-6+off,y+24, 6,6);       // left foot
      g.fillRect(x+6,y+18, 8,8);           // right thigh
      g.fillRect(x+8-off,y+24, 6,6);       // right foot
      // arm
      g.fillRect(x+4,y+8, 8,4);
      // neck & head
      g.fillRect(x+8,y-10, 10,10);
      g.fillRect(x+16,y-8, 12,8);
      // eye
      g.fillStyle='#000'; g.fillRect(x+24,y-6, 2,2);
      // teeth
      g.fillStyle='#fff'; g.fillRect(x+20,y-2, 6,2); g.fillRect(x+26,y-2, 2,2);
    }

    function drawTunnel(){
      // right-side tunnel entrance
      const tx = W - 30;
      const ty = 120;
      g.fillStyle = '#1f1f1f';
      g.fillRect(tx, ty-10, 26, 40);
      g.fillStyle = '#555';
      g.fillRect(tx+2, ty-6, 22, 32);
      // yellow stripe road
      g.fillStyle = '#ffd460';
      g.fillRect(tx-60, ty+21, 60, 2);
    }

    // Animation loop
    function loop(){
      t++;
      // Background
      bgScroll += 0.6;
      drawSky();
      drawGround(bgScroll);

      // If player has won, show tunnel
      if(ended && idx >= words.length){
        drawTunnel();
      }

      // Position entities from gap centerpoint
      jeep.x = 170 + gap/2;
      rex.x  = 150 - gap/2;
      // Bobbing
      jeep.y = 118 + Math.sin(t/12)*1.5;
      rex.y  = 112 + Math.sin(t/10)*1.0;
      rex.frame = t;

      // Clamp so they remain on screen
      jeep.x = Math.max(36, Math.min(W-36, jeep.x));
      rex.x  = Math.max(18, Math.min(W-36, rex.x));

      // Draw
      drawJeep(jeep.x, jeep.y);
      drawRex(rex.x, rex.y, rex.frame);

      // If gap small and game is still playing, make it a little tense
      if(playing && gap < 12){
        // subtle camera shake
        const dx = (Math.random()-.5)*2;
        const dy = (Math.random()-.5)*2;
        g.drawImage(gameCanvas, dx, dy);
      }
      requestAnimationFrame(loop);
    }
    loop();

    // --- Events ---
    startBtn.addEventListener('click', startGame);
    sampleBtn.addEventListener('click', ()=>{
      wordList.value = `dinosaur, fossil, jeep, jungle, escape, tunnel, volcano, fossilize, museum, skeleton`;
    });
    goBtn.addEventListener('click', submitAnswer);
    replayBtn.addEventListener('click', ()=> speak(currentWord));
    resetBtn.addEventListener('click', resetGame);
    answer.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){ submitAnswer(); }
    });

    // --- Sketch pad drawing ---
    let drawing=false, lastX=0, lastY=0;
    function skDown(x,y){ drawing=true; lastX=x; lastY=y; }
    function skMove(x,y){
      if(!drawing) return;
      sg.strokeStyle = '#e9eef6';
      sg.lineWidth = penWidth;
      sg.beginPath();
      sg.moveTo(lastX,lastY);
      sg.lineTo(x,y);
      sg.stroke();
      lastX=x; lastY=y;
    }
    function skUp(){ drawing=false; }

    function getPos(e){
      const rect = sketch.getBoundingClientRect();
      if(e.touches && e.touches[0]){
        return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
      }else{
        return { x: e.clientX - rect.left, y: e.clientY - rect.top };
      }
    }

    sketch.addEventListener('mousedown', (e)=>{ const p=getPos(e); skDown(p.x,p.y); });
    sketch.addEventListener('mousemove', (e)=>{ const p=getPos(e); skMove(p.x,p.y); });
    window.addEventListener('mouseup',  skUp);

    sketch.addEventListener('touchstart', (e)=>{ const p=getPos(e); skDown(p.x,p.y); e.preventDefault(); }, {passive:false});
    sketch.addEventListener('touchmove',  (e)=>{ const p=getPos(e); skMove(p.x,p.y); e.preventDefault(); }, {passive:false});
    sketch.addEventListener('touchend',   (e)=>{ skUp(); e.preventDefault(); }, {passive:false});

    clearSketch.addEventListener('click', ()=> resizeSketch());
    thinPen.addEventListener('click', ()=>{ penWidth=3; });
    thickPen.addEventListener('click',()=>{ penWidth=7; });

    window.addEventListener('resize', resizeSketch);
    resizeSketch();

    // Make sure voices are loaded on some browsers
    if ('speechSynthesis' in window){
      window.speechSynthesis.onvoiceschanged = ()=>{};
    }
  })();
  </script>
</body>
</html>
